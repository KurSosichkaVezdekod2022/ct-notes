\documentclass{article}
\input{Headers/header}
\input{Headers/formal}
\input{Headers/graphs}

\fancyhead[L]{Дискретная математика}

\begin{document}
    \section{Производящие функции.}
    \begin{remark}
        Вообще производящая функция~--- не очень такое название. Потому что это скорее не функция, а способ записи бесконечных последовательностей.\\
        Вот есть у нас $2,4,8,16,\ldots$ и сразу понятно, что имеется ввиду. А вот когда мы видим $1,2,5,14,42$ и знающие люди поймут, что это, скорее всего, числа Каталана. Но всё равно это не то чтобы однозначно определяет, что мы имеем ввиду.\\
        Можно записать $a_n=2^n$ и сразу станет понятно, что это степени двойки. А когда мы запишем $a_n=C_n$, то поймут точно не все.\\
        Короче, работать с такими вещами не очень приятно. И люди задумались: а как компьютеру дать бесконечные последовательности, чтобы он их понял.\\
        И люди нашли инструмент из теории вероятности и статистики~--- собственно, производящие функции.
    \end{remark}
    \begin{definition}
        Пусть $\{a_n\}_{n=0}^\infty$~--- последовательность. Тогда \textbf{формальный степенной ряд} этой последовательности~--- это запись вида
        $$
        A(t)=a_0t^0+a_1t^1+a_2t^2+\cdots+a_nt^n+\cdots
        $$
    \end{definition}
    \begin{remark}
        Вот есть у нас многочлен: $t^2+t-7$. Что такое $t$? Ну, по сути, буква. Она не обладает значением, мы можем только потом уже рассмотреть многочлен как многочлен над каким-то кольцом, и уже значения его анализировать.\\
        Вот и тут по сути мы имеем просто букву $t$, она ничему не равна.
    \end{remark}
    \begin{claim}
        Очевидно, формальные степенные ряды биективно сопоставляются последовательностям.
    \end{claim}
    \begin{remark}
        Пока что формальный степенной ряд ничем не лучше просто последовательности. Но на самом деле с формальными степенными рядами можно производить полезные операции, которые позволят нам конечным количеством символов описать интересующие нас последовательности.
    \end{remark}
    \begin{example}
        Какие формальные степенные ряды мы уже можем легко записать? Ну, те, которые соответствуют многочленам. То есть формальные степенные ряды тех последовательностей, которые имеют конечное количество ненулевых элементов.
    \end{example}
    \begin{definition}
        Суммой формальных степенных рядов называется степенной ряд суммы их последовательностей.\\
        Умножением формального ряда на число называется произведение его последовательности и этого числа.
    \end{definition}
    \begin{remark}
        Понятно, что это согласуется с тем, как мы могли бы сложить ряды.\\
        Но ведь ряды ещё можно умножать. Что получим?
    \end{remark}
    \begin{definition}
        \textbf{Произведением формальных степенных рядов}
        $$
        A(t)=a_0t^0+a_1t^1+a_2t^2+\cdots+a_nt^n+\cdots\qquad B(t)=b_0t^0+b_1t^1+b_2t^2+\cdots+b_nt^n+\cdots
        $$
        называется ряд
        $$
        (AB)(t)=C(t)=c_0+c_1t^1+c_2t^2+\cdots+c_nt^n+\cdots\qquad c_k=\sum\limits_{j=0}^ka_jb_{k-j}
        $$
    \end{definition}
    \begin{remark}
        А делить как? Ну, если $\frac{A(t)}{B(t)}=C(t)$, то $A(t)=(BC)(t)$. Ну,
        $$
        a_0=b_0c_0\Rightarrow c_0=\frac{a_0}{b_0}
        $$
        $$
        a_1=b_1c_0+b_0c_1\Rightarrow c_1=\frac{a_1-c_0b_1}{b_0}
        $$
    \end{remark}
    \begin{definition}
        \textbf{Частным формальных степенных рядов}
        $$
        A(t)=a_0t^0+a_1t^1+a_2t^2+\cdots+a_nt^n+\cdots\qquad B(t)=b_0t^0+b_1t^1+b_2t^2+\cdots+b_nt^n+\cdots
        $$
        где $b_0\neq0$ называется ряд
        $$
        (\frac AB)(t)=C(t)=c_0+c_1t^1+c_2t^2+\cdots+c_nt^n+\cdots\qquad c_k=\frac{a_k-\sum\limits_{j=0}^{k-1}c_jb_{k-j}}{b_0}
        $$
    \end{definition}
    \begin{example}
        $$
        \frac1{1-t-t^2}
        $$
        Так, $c_0=1$,
        $$
        c_1=\frac{a_1-c_0b_1}{b_0}=1
        $$
        $$
        c_2=\frac{a_2-c_1b_1-c_0b_2}{b_0}=2
        $$
        Давайте в общем виде, учитывая тот факт, что $b_k=0$ для $k>2$,
        $$
        c_n=a_n-c_{n-1}b_1-c_{n-2}b_2=c_{n-1}+c_{n-2}
        $$
        Да это же числа Фибоначчи!
    \end{example}
    \begin{claim}
        Если $a_n\in\mathbb Z$, $b_n\in\mathbb Z$, $b_0=\pm1$, $C(t)=\frac{A(t)}{B(t)}$, то $c_n\in\mathbb Z$.
    \end{claim}
    \begin{proof}
        Очевидно.
    \end{proof}
    \begin{example}
        Давайте получим $2^n$! Что нам хочется?
        $$
        P(t)=1+2t+4t^2+\cdots+2^nt^n+\cdots
        $$
        Хм-м-м-м. Может, так:
        $$
        P(t)=(2t)^0+(2t)^1+(2t)^2+\cdots+(2t)^n+\cdots
        $$
        Хм-м-м, кажется, геометрическая прогрессия.
        $$
        P(t)=\frac1{1-2t}
        $$
        Ок?
    \end{example}
    \begin{remark}
        Ну, очень хочется так думать, но вообще так жить некорректно, неверно интерпретировать $t$ как число. Потому что если мы будем, то мы придём в мат. анализ и вспомним о том, что у рядов есть радиус сходимости, и если ряд условно сходится или расходится, то мы проиграли.\\
        Но почему производящие функции использовались в мат. статистике? Потому что к ним часто применяется следующий приём: давайте сделаем то, что делать нельзя, получим что-то, а потом как-нибудь иным способом докажем, что наш ответ норм.
    \end{remark}
    \begin{example}
        Мы получили
        $$
        P(t)=\frac1{1-2t}
        $$
        Давайте проверим, что подходит.
        $$
        a_0=1,a_{k\geqslant1}=0\qquad b_0=1,b_1=-2,b_{n\geqslant2}=0
        $$
        $$
        c_0=\frac{a_0}{b_0}=1\qquad c_1=\frac{a_1-c_0b_1}{b_0}=2\qquad c_n=-c_{n-1}b_1=2c_{n-1}
        $$
        Действительно, подходит.
    \end{example}
    \begin{remark}
        Почему мы так делаем вообще? Потому что у нас для некоторых $t$ верна формула
        $$
        (2t)^0+(2t)^1+(2t)^2+\cdots+(2t)^n+\cdots=\frac1{1-2t}
        $$
        И если бы мы получили иной ряд на самом деле при делении, мы бы получили, что указанная выше формула не верна нигде. Есть патологические примеры (см. математический анализ, функция со всеми нулевыми производными, не равная тождественно нулю), но в целом обычно получается жить в ситуации, когда мы нарушаем правила математики, а потом доказываем, что получили верный ответ.
    \end{remark}
    \begin{example}
        Хорошо, давайте построим числа Каталана. Мы знаем, что
        $$
        C_n=\sum\limits_{i=0}^{n-1}C_iC_{n-i-1}
        $$
        Та-а-а-ак, что-то знакомое. Пусть $C(t)$~--- числа Каталана. Тогда из формулы выше хотелось бы, чтобы получилось
        $$A(t)=C(t)C(t)$$
        Где $A(t)$~--- числа Каталана со сдвинутыми коэффициентами. Как нам сдвинуть коэффициенты? Умножить на $t$:
        $$
        C(t)=C(t)C(t)t
        $$
        Это почти хорошо, разве что тут нулевой коэффициент получится ноль, а нам надо 1:
        $$
        C(t)=C(t)C(t)t+1
        $$
        Так, ну, хорошо, начинаем делать грязь:
        $$
        C(t)=\frac{1\pm\sqrt{1-4t}}{t}
        $$
        Тут всё плохо. Тут и $\pm$, и корень формального ряда и деление на $t$, а на $t$ делить нельзя т.к. у него нулевой коэффициент ноль.\\
        Ну, делаем грязь дальше. Что делать с корнем? По Тейлору раскладывать, конечно же
        $$
        (1+x)^\alpha=1+\frac\alpha1x+\frac{\alpha(\alpha-1)}2x^2+\cdots+\frac{\alpha(\alpha-1)\cdot\cdots\cdot(\alpha-n+1)}{n!}x^n+\cdots
        $$
        Это мы так легко не докажем, но у нас $\alpha$ конкретное ($\frac12$), и вот верность этой формулы для него доказать можно довольно легко.
        $$
        \sqrt{1-4t}=1-\frac{1/2}14t+\frac{(1/2)(-1/2)}216t^2-\frac{(1/2)(-1/2)(-3/2)}664t^3+\frac{(1/2)(-1/2)(-3/2)(-5/2)}{24}256t^4+\cdots
        $$
        Хорошо, давайте попытаемся это посчитать. Получим
        $$
        1-2t-4t^2-10t^5-28t^5-\cdots
        $$
        Теперь оставшиеся две проблемы: $\pm$ и деление на $t$. Посмотрим на второе. Почему мы не хотели делить на $t$? Потому что у нас был $a_0$, который не поделить на $0$. Но если свободного члена нет, то будет логично делить на $t$. Так понятно, что нам надо взять $\pm$ как $-$. И мы, как нетрудно заметить, получим числа Каталана.
    \end{example}
    \begin{remark}
        Хорошо, какие ещё у нас есть операции? Ну, интегрирование и дифференцирование. Например, что будет, если мы хотим каждый коэффициент умножить на его номер? Ну, очевидно, так:
        $$
        B(t)=A'(t)\cdot t
        $$
    \end{remark}
    \begin{definition}
        \textbf{Производной формального степенного ряда} называется понятно, что.
    \end{definition}
    \begin{property}
        Несложно проверить формулы производной произведения и производной частного для формальных степенных рядов.
    \end{property}
    \begin{definition}
        Интегралом формального степенного ряда называется также понятно, что, разве что константа интегрирования равна нулю. Обозначение:
        $$
        \int A(t)
        $$
    \end{definition}
    \begin{remark}
        Из-за последнего (конкретной константы интегрирования) интегралами пользуются довольно нечасто.
    \end{remark}
    \begin{property}
        Несложно проверить, что верна формула интегрирования по частям.
    \end{property}
    \begin{remark}
        Ну что, подставляем один ряд в другой?\\
        Пусть есть
        $$A(t)=a_0+a_1t+a_2t^2+\cdots+a_nt^n+\cdots$$
        $$B(t)=b_0+b_1t+b_2t^2+\cdots+b_nt^n+\cdots$$
        Тогда что такое $A(B(t))$?
        $$
        C(t)=A(B(t))=a_0+a_1(b_0+b_1t+b_2t^2+\cdots+b_nt^n+\cdots)+a_2(b_0+b_1t+b_2t^2+\cdots+b_nt^n+\cdots)^2+\cdots
        $$
        Ну и что с этим делать? У нас даже свободный член нормально не считается, там получится $a_0+a_1b_0+a_2b_0^2+\cdots$. Это вообще какая-то сумма ряда, а это, во-первых, матан, во-вторых, радиусы сходимости и прочий ужас.\\
        Нам не нравится $b_0$, пусть подставлять можно только ряд с $b_0=0$. Тогда $c_0=a_0$. Чему равно $c_1$? Ну, во второй скобке там степени не ниже квадрата. Значит
        $$
        c_1=a_1b_1
        $$
        А $c_2$? Ну,
        $$
        c_2=a_1b_2+a_2b_1^2
        $$
        Пока непонятно, давайте запишем $c_3$:
        $$
        c_3=a_1b_3+a_2(b_1b_2+b_2b_1)+a_3b_1^3
        $$
        Кринж какой-то, но уже что-то более понятное.
    \end{remark}
    \begin{definition}
        Пусть
        $$A(t)=a_0+a_1t+a_2t^2+\cdots+a_nt^n+\cdots$$
        $$B(t)=b_1t+b_2t^2+\cdots+b_nt^n+\cdots$$
        Тогда \textbf{подстановкой формального степенного ряда} $B$ \textbf{в ряд} $A$ называется ряд
        $$
        C(t)=c_0+c_1t+c_2t^2+\cdots+c_nt^n+\cdots\qquad c_n=\sum\limits_{k=0}^na_k\sum\limits_{n=i_1+\cdots+i_k}\prod\limits_{j=1}^kb_{i_j}
        $$
    \end{definition}
    \begin{theorem}
        Пусть дана последовательность $a_n$. Следующие три условия эквивалентны:
        \begin{enumerate}
            \item $A=\frac PQ$, где $P$ и $Q$~--- многочлены.
            \item $a_n$ задаётся рекуррентным соотношением:
            $$
            \forall n\geqslant m~a_n=c_1a_{n-1}+c_2a_{n-2}+\cdots+c_ka_{n-k}
            $$
            Где $m\geqslant k$~--- некоторые натуральные числа, $c_j$~--- некоторые вещественные числа.
            \item Для некоторого $n_0\in\mathbb N$ выполнено
            $$
            \forall n>n_0~a_n=\sum\limits_{i=1}^sp_i(n)r_i^n
            $$
            Где $s$~--- некоторое натуральное число, $r_i\in\mathbb C$.
        \end{enumerate}
    \end{theorem}
    \begin{proof}
        \begin{itemize}
            \item[$1\to2$] Известно, что
            $$
            A(t)=\frac{p_0+p_1t+\cdots+p_mt^m}{q_0+q_1t+\cdots+q_kt^k}
            $$
            Известно, что $q_0\neq0$, иначе нельзя делить. Далее Н.У.О. $q_0=1$ (иначе поделим числитель и знаменатель на $q_0$).\\
            Давайте делить:
            \begin{align*}
                a_0&=p_0\\
                a_1&=p_1-q_1a_0\\
                \cdots&
            \end{align*}
            Дальше у нас что-то кончится раньше, либо $k$, либо $m$. Пусть, например, $k$:
            \begin{align*}
                a_k&=p_k-q_1a_{k-1}-q_2a_{k-2}-\cdots-q_{k}a_0\\
                a_{k+1}&=p_{k+1}-q_1a_{k}-q_2a_{k-1}-\cdots-q_{k}a_1-\underbrace{q_{k+1}a_0}_0\\
                \cdots&
            \end{align*}
            Потом у нас кончится $m$. И дальше будет то же самое, но без $p_n$. А это как раз условие 2.
            \item[$2\to1$] Известно
            $$
            A(t)=a_0+a_1t+a_2t^2+\cdots
            $$
            Домножим это на некоторые штуки:
            \begin{align*}
                A(t)=a_0+a_1t+&a_2t^2+\cdots\\
                A(t)t=a_0t+&a_1t^2+a_2t^3+\cdots\\
                A(t)t^2={}&a_0t^2+a_1t^3+a_2t^4+\cdots
            \end{align*}
            А теперь давайте возьмём нашу рекурренту и заменим $a_{n-j}$ на $A(t)t^j$:
            $$
            A(t)-c_1A(t)t-c_2A(t)t^2-\cdots-c_kA(t)t^k
            $$
            У нас тогда по рекуррентному соотношению все коэффициенты при $t^{>m}$ будут ноль. То есть разность получится равной какому-то многочлену $m$-той степени. Ну так извините, получим
            $$
            A(t)=\frac{P(t)}{1-c_1t-c_2t^2-\cdots-c_kt^k}
            $$
        \end{itemize}
    \end{proof}
    \begin{remark}
        Из этого мы можем решить такую задачу: пусть есть последовательность, заданная линейной рекуррентой. Нам надо узнать, нельзя ли уменьшить рекурренте порядок.\\
        Ну, как мы выяснили, порядок рекурренты равен степени знаменателя, а значит надо представить нашу последовательность как частное двух последовательностей и сократить максимально сильно. Чтобы сократить, надо научиться искать НОД двух многочленов (алгоритмом Евклида, например).
    \end{remark}
    \begin{remark}
        Другая задачка: возьмём рекурренту и найдём $a_n$.
        $$
        a_n=c_1a_{n-1}+c_2a_{n-2}+\cdots+c_ka_{n-k}
        $$
        Запишем вот такое (очевидно, выполненное) равенство:
        $$
        \matr{
            a_{n}\\
            a_{n-1}\\
            \vdots\\
            a_{n-k+2}\\
            a_{n-k+1}
        }=\matr{
            c_1 & c_2 & \cdots & c_{k-1} & c_k\\
            1 & 0 & \cdots & 0 & 0\\
            0 & 1 & \cdots & 0 & 0\\
            \vdots & \vdots & \ddots & \vdots & \vdots\\
            0 & 0 & \cdots & 1 & 0
        }\matr{
            a_{n-1}\\
            a_{n-2}\\
            \vdots\\
            a_{n-k+1}\\
            a_{n-k}
        }
        $$
        назовём первое $\vec{a_n}$, второе~--- $C$, третье~--- $\vec{a_{n-1}}$, всё, что нам надо, быстро возвести $C$ в степень.\\
        Но можно решить это за $k^2\log n$.
    \end{remark}
    \begin{example}
        Давайте возьмём числа Фибоначчи:
        $$
        f_n=f_{n-1}+f_{n-2}
        $$
        И мы знаем формулу
        $$
        \frac1{1-t-t^2}
        $$
        И домножим числитель и знаменатель на $1+t+t^2$:
        $$
        \frac{1+t+t^2}{1-3t^2+t^4}
        $$
        Если взять это и получить отсюда рекурренту, получим
        $$
        f_n=3f_{n-2}-f_{n-4}
        $$
        А если сделать это ещё раз, получим
        $$
        f_n=7f_{n-4}-f_{n-8}
        $$
        То есть нам нужно значительно меньше считать.
    \end{example}
    \begin{remark}
        Более глобально,
        $$
        A(t)=\frac{P(t)}{Q(t)}=\frac{P(t)Q(-t)}{Q(t)Q(-t)}=\frac{P_0(t^2)+P_1(t^2)t}{Q_1(t^2)}
        $$
        Таким образом можно решить задачку по поиску $a_n$ за $(m+k)k\log n$
    \end{remark}
    \begin{remark}
        Теперь давайте разбираться с третьим утверждением теоремы.
    \end{remark}
    \begin{lemma}
        Если $a_n=n^kr^n$, то $A$~--- дробно-рациональный формальный степенной ряд.
    \end{lemma}
    \begin{proof}
        Индукция по $k$. Для $r^n$ знаем ($\frac1{1-rt}$), переход: пусть $n^{k-1}r^n=\frac{P(t)}{Q(t)}$, то чему равно $n^{k}r^n$? Ну, возьмём производную и домножим на $t$. Получим, как нетрудно заметить, отношение многочленов.
    \end{proof}
    \begin{remark}
        На практике это не очень применимо т.к. очень быстро растёт степень знаменателя. Давайте докажем, что $n^kr^n$ представим как
        $$
        \frac{P_k(t)}{(1-rt)^{k+1}}
        $$
        Понятно, что $P_0=1$, и всё хорошо. Переход индукции:
        $$
        \left(P_k(t)\frac1{(1-rt)^k}\right)'t=P'_k(t)\frac t{(1-rt)^k}+P_k(t)\frac t{(1-rt)^{k+1}}
        $$
    \end{remark}
    \begin{proof}
        Мы уже доказали, что из 1 следует 3 в теореме. Докажем обратно.\\
        Воспользуемся основной теоремой алгебры. Пусть $\deg Q=k$, тогда у него $k$ корней с учётом кратности. Не умаляя общности $Q=1-c_1t-c_2t^2-\cdots-c_kt^k$. Пусть корни $Q$ равны $x_i$ и кратность у них $s_i$. Тогда $\frac{P(t)}{Q(t)}$, как мы знаем из математического анализа, можно разложить на простые дроби:
        $$
        \frac{P(t)}{Q(t)}=\sum\limits_{i=1}^l\frac{P_i(t)}{(1-r_it)^{s_i}}
        $$
        То есть нам достаточно доказать, что $\frac{t^m}{(1-rt)^{s}}$ представим как $a_n=p(n)r^n$. Давайте сначала разберёмся для $m=0$. И разберёмся индукцией по $s$. Для $s=1$ мы знаем, $p(n)\equiv1$. Что для больших $s$? Ну, продифференцируем нашу формулу
        $$B'(t)=\left(\frac1{(1-rt)^{s}}\right)'=\frac{sr}{(1-rt)^{s+1}}$$
        То есть $\frac1{(1-rt)^{s+1}}=\frac{B'(t)}{sr}$. И если раньше мы имели $p(n)r^n$, то теперь имеем $\frac{p(n+1)(n+1)r^{n+1}}{sr}$, и это то, что нам надо.\\
        А если брать $t^m$ в числителе, то получим $a_n=p(n-m)r^{-m}r^n$, если $m\leqslant n$.
    \end{proof}
    \begin{remark}
        Что, кстати, видим, так это то, что $\deg p=k-1$.
    \end{remark}
    \begin{remark}
        Также, как несложно заметить, асимптотика роста последовательности зависит только от наименьшего по модулю корня знаменателя. Остаётся лишь вопрос, что, если таковых несколько? Ну, рассмотрим
        $$
        \frac1{1-t^2}
        $$
        Если посмотреть на члены этой последовательности, то там чередуются нули и единицы. А в более общем случае, если взять
        $$
        M=\operatorname{lcm}\left(\frac{2\pi}{\arg r_i}\right)
        $$
        То последовательность распадётся на $M$ независимых, каждая из которых растёт с асимптотикой $u^n\left(e^{\im\varphi_i(n\%M)}\right)$, где $u$~--- модуль $r_i$.
    \end{remark}
    \begin{remark}
        Давайте возьмём прямоугольник $2\times n$ и просуммируем все способы его замостить. И ещё для всех $n$ просуммируем.\\
        Все замещения, кроме пустого, начинаются либо с вертикальной доминошки, либо с двух горизонтальных. Давайте сгруппируем так слагаемые и вынесем за скобки начало. Нетрудно заметить, что в скобках все возможные замощения. Итого имеем, что сумма всех замощений $S$~--- пустое замощение плюс $S$ на сумму вертикальной доминошки и горизонтальной в квадрате. Умеем ли мы делить один на разность пустого замощения и суммы вертикальной доминошки и горизонтальной в квадрате? Ну, почему нет. Получится сумма всех замощений, это мы уже знаем.\\
        Но смотрите. Мы получили буквально формальные степенные ряды, если заменить количество доминошек на степень. И мы имеем, что фигура из $k$ доминошек имеет <<вес>> $d^k$, и по сути мы тут считаем комбинаторыне объекты заданного веса.
    \end{remark}
\end{document}